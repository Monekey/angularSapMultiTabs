/*
 * *************************************************************************
 * sgcWebSocket component
 * 
 * written by eSeGeCe copyright ?2013 Email : info@esegece.com Web :
 * http://www.esegece.com
 * *************************************************************************
 */

function sgcws(){if(arguments.length==0)return;arguments.length==1?typeof arguments[0]=="object"?(arguments[0].subprotocol="esegece.com",sgcWebSocket.call(this,arguments)):typeof arguments[0]=="string"&&(arguments[1]="esegece.com",sgcWebSocket.call(this,arguments[0],arguments[1])):arguments.length==2&&(typeof arguments[0]=="object"?(arguments[0].subprotocol=arguments[1]+".esegece.com",sgcWebSocket.call(this,arguments)):typeof arguments[0]=="string"&&(arguments[1]=arguments[1]+".esegece.com",sgcWebSocket.call(this,arguments[0],arguments[1])));var g=this.send;this.send=function(l,n,k,m){arguments.length==1?arguments[0]='{"jsonrpc":"2.0", "method":"sgc@message", "params":{"message":"'+l+'"}, "id":"'+GUID()+'"}':arguments.length==2?arguments[0]='{"jsonrpc":"2.0", "method":"'+n+'", "params":{"message":"'+l+'"}, "id":"'+GUID()+'"}':m!==""&&m!==undefined?arguments[0]='{"jsonrpc":"2.0", "method":"'+n+'", "params":{"channel":"'+k+'", "message":"'+l+'"}, "id":"'+m+'"}':arguments[0]='{"jsonrpc":"2.0", "method":"'+n+'", "params":{"channel":"'+k+'", "message":"'+l+'"}}',g.apply(this,arguments)},this.broadcast=function(){arguments.length==1?this.send(arguments[0],"sgc@broadcast",""):arguments.length==2&&this.send(arguments[0],"sgc@broadcast",arguments[1])},this.publish=function(){this.send(arguments[0],"sgc@publish",arguments[1])},this.subscribe=function(k){this.send("","sgc@subscribe",k,GUID())},this.unsubscribe=function(k){this.send("","sgc@unsubscribe",k,GUID())},this.rpc=function(m,l,k){arguments[0]='{"jsonrpc":"2.0", "method":"'+l+'", "params":'+k+', "id":"'+m+'"}',g.apply(this,arguments)},this.notify=function(l,k){arguments[0]='{"jsonrpc":"2.0", "method":"'+l+'", "params":'+k+'"}',g.apply(this,arguments)},this.request=function(k){arguments[0]='{"jsonrpc":"2.0", "method":"'+k+'"}',g.apply(this,arguments)},this.getsession=function(){this.request("sgc@session")},this.starttransaction=function(k){k==undefined&&(k=""),this.send("","sgc@transaction",k,"")},this.commit=function(k){k==undefined&&(k=""),this.send("","sgc@commit",k,"")},this.rollback=function(k){k==undefined&&(k=""),this.send("","sgc@rollback",k,"")};var c=new event("onsgcmessage"),h=new event("onsgcevent"),d=new event("onsgcsubscribe"),f=new event("onsgcunsubscribe"),j=new event("onsgcrpcresult"),b=new event("onsgcrpcerror"),i=new event("onsgcacknowledgment"),a=new event("onsgcsession");this.on("message",function(l){var k=l.message;obj=JSON.parse(k),obj.result!==undefined?obj.result.method=="sgc@subscribe"?d.fire({name:"onsgcsubscribe",channel:obj.result.channel}):obj.result.method=="sgc@unsubscribe"?f.fire({name:"onsgcunsubscribe",channel:obj.result.channel}):obj.result.method=="sgc@event"?h.fire({name:"onsgcevent",channel:obj.result.channel,message:obj.result.message}):obj.result.method=="sgc@session"?a.fire({name:"onsgcsession",guid:obj.result.message}):obj.result.method=="sgc@message"?c.fire({name:"onsgcmessage",message:obj.result.message}):obj.result.method=="sgc@acknowledgment"?i.fire({name:"onsgcacknowledgment",id:obj.id}):j.fire({name:"onsgcrpcresult",result:obj.result,id:obj.id}):obj.error!==undefined&&b.fire({name:"onsgcrpcerror",code:obj.error.code,message:obj.error.message,data:obj.error.data})});var e=this.on;this.on=function(k,l){k=="sgcmessage"?c.subscribe(l):k=="sgcevent"?h.subscribe(l):k=="sgcsession"?a.subscribe(l):k=="sgcsubscribe"?d.subscribe(l):k=="sgcunsubscribe"?f.subscribe(l):k=="sgcacknowledgment"?i.subscribe(l):k=="sgcrpcresult"?j.subscribe(l):k=="sgcrpcerror"?b.subscribe(l):e.apply(this,arguments)}}sgcws.prototype=new sgcWebSocket,sgcws.prototype.constructor=sgcws;