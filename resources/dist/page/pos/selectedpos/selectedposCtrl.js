define(["angular","posService"],function(angular){return["$scope","ajaxService","getCookieService","$rootScope","modalService","$state","posService",function($scope,ajaxService,getCookieService,$rootScope,modalService,$state,posService){function copyArr(src){var des=[];for(var i=0;i<src.length;i++)des.push(angular.copy(src[i]));return des}function setDataToPage(result){var systemShortCutcount=0,memberShortCutcount=0;$scope.shortcutmenu=[],$scope.tempshortcutmenu=result.data,$scope.tempshortcutmenu.forEach(function(menu){(menu.shortcutMenu==1||menu.shortcutMenu==2)&&$scope.shortcutmenu.push(menu),menu.shortcutMenu==2&&systemShortCutcount++,memberShortCutcount++}),$scope.shortcutmenu.forEach(function(shotMenu){var icon=shotMenu.img.split(":")[0],color=shotMenu.img.split(":")[1],clickColor=shotMenu.img.split(":")[2];shotMenu.icon=icon,shotMenu.color=color,shotMenu.clickColor=clickColor}),$scope.systemShortCutcount=systemShortCutcount,$scope.memberShortCutcount=memberShortCutcount,$rootScope.routeruledata=$scope.tempshortcutmenu,$scope.popupOperteMenu=copyArr(result.data),posService.listenerKey($scope.shortcutmenu)}angular.element(document.getElementsByTagName("body")[0]).css("background","#dee6f2");var sessionId=getCookieService.getCookie("CRMSESSIONID"),data={sessionId:sessionId};$scope.paramValue="",$scope.searchdata={paramValue:""},$rootScope.searchuserresult=null,$scope.shortcutmenu=[],$scope.popupOperteMenu=[],ajaxService.AjaxPost(data,"postrade/memberhome/shortcutmenu.do").then(function(result){setDataToPage(result)}),ajaxService.AjaxPost(data,"postrade/memberhome/posbuttenmenu.do").then(function(result){result.status===1&&($rootScope.posbuttens=result.data)}),$scope.checked=function(index,one){var fix=0;$scope.popupOperteMenu.forEach(function(menu){menu.shortcutMenu&&menu.shortcutMenu==1&&fix++}),$scope.popupOperteMenu[index].shortcutMenu==1?$scope.popupOperteMenu[index].shortcutMenu=0:fix<3?$scope.popupOperteMenu[index].shortcutMenu=1:$scope.isEnough=!1},$scope.gotoPos=function(one){$rootScope.cardoperatetoeditusrmemberinfo=null,$rootScope.currentuserinfo=null,posService.gotoPos(one)},$scope.updatedata={cutmenu:[{template:"",fatherCode:"",showName:"",shortcutMenu:"",img:"",orderby:"",hasChildTree:"",code:"",type:"",ctrl:"",childTree:[]}]},$scope.confirmIn=function(){$scope.updatedata.cutmenu=$scope.popupOperteMenu,$scope.updatedata.sessionId=sessionId,ajaxService.AjaxPost($scope.updatedata,"postrade/memberhome/modifyusercutmenu.do").then(function(result){result.status==1&&(result.data=result.cutmenu,setDataToPage(result),$scope.isShowCustomPanel=!1)})},$scope.cancel=function(){$scope.popupOperteMenu=copyArr($scope.tempshortcutmenu),$scope.isShowCustomPanel=!1},$scope.enterKey=function(searchValue,event){var keyCode=window.event?event.keyCode:event.which;keyCode===13&&$scope.clicksearch(searchValue),event.stopPropagation()},$scope.clicksearch=function(searchValue){if(!/^(((13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8})|([1-9](\d{4,9}|\d{11,15})))$/.test(searchValue)){modalService.info({title:"提示",content:"请输入正确手机号或卡号!",size:"sm",type:"confirm"});return}$scope.searchdata.paramValue=searchValue,$scope.searchdata.sessionId=sessionId,ajaxService.AjaxPost($scope.searchdata,"postrade/memberhome/memberhomeinfo.do").then(function(result){result.status&&($rootScope.searchuserresult=result.data,$state.go("pos.cardoperte.mainpage"))})},$scope.isShowCustomPanel=!1,$scope.customBtn=function(){$scope.isShowCustomPanel=!$scope.isShowCustomPanel},$scope.getBtnColor=function(img){var icon=img.split(":")[0],color=img.split(":")[1];return{background:color}},$scope.postrademanage=function(){var data={code:"",showName:"",fatherCode:"",childTree:"",orderby:"",maxLevel:"",hasChildTree:"",template:"",ctrl:"",img:"",routing:"",authority:"",type:"",shortcutMenu:""};$state.go("postrademanage")},$scope.posSellCard=function(){var data={code:"",showName:"",fatherCode:"",childTree:"",orderby:"",maxLevel:"",hasChildTree:"",template:"",ctrl:"",img:"",routing:"",authority:"",type:"",shortcutMenu:""};$state.go("pos.possellcard")}}]});