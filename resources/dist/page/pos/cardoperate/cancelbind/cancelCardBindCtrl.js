define(["require","ngAMD","posService"],function(require){var ngAMD=require("ngAMD"),posServive=require("posService");ngAMD.controller("cancelCardBindCtrl",["$scope","$state","$rootScope","ajaxService","cancelBindModal","modalService","$uibModalInstance","getCookieService","posService",function($scope,$state,$rootScope,ajaxService,cancelBindModal,modalService,$uibModalInstance,getCookieService,posService){var sessionId=getCookieService.getCookie("CRMSESSIONID");$scope.card={mobile:cancelBindModal.mobile,cardNo:"",cardId:"",cardTypeName:"",memberName:"",password:"",sessionId:sessionId},ajaxService.AjaxPost({mobile:$scope.card.mobile,sessionId:sessionId},"postrade/posCardUsed/getCardInfoByMobile.do").then(function(result){result.status&&($scope.card.cardId=result.cardId,$scope.card.cardNo=result.cardNo,$scope.card.cardTypeName=result.cardTypeName,$scope.card.memberName=result.memberName)}),$scope.saveCancelBind=function(){if(!$scope.card.cardNo||$scope.card.cardNo=="")return modalService.info({title:"提示",content:"不能获取卡信息!",size:"sm",type:"confirm"}),!1;if(!$scope.card.password||$scope.card.password==""||!/^\d{6}$/.test($scope.card.password))return modalService.info({title:"提示",content:"请输入6位数原密码!",size:"sm",type:"confirm"}),!1;ajaxService.AjaxPost($scope.card,"postrade/posCardUsed/cancelCardBind.do").then(function(result){if(result.status){var cancelResult={status:result.status};$uibModalInstance.close(cancelResult)}else $uibModalInstance.dismiss("cancel")},function(data){$uibModalInstance.dismiss("cancel")})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")},$scope.resetPasswd=function(cardNo){var routeruledata=$rootScope.routeruledata,target=null;for(var i=0;i<routeruledata.length;i++)routeruledata[i].code=="10045"&&(target=routeruledata[i]);target&&(posService.gotoPos(target),$rootScope.cardNoForResetPasswd=cardNo,$uibModalInstance.dismiss("cancel"))}}])});