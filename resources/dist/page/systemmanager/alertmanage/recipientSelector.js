define(["require","ngAMD","angular"],function(require){var ngAMD=require("ngAMD"),angular=require("angular");ngAMD.controller("recipientSelectorCtrl",["$scope","ajaxService","getCookieService","noticeEmps","$uibModalInstance",function($scope,ajax,cookie,noticeEmps,$uibModalInstance){function getEmpByRoleId(roleId){refreshEmps(roleId,noticeEmps)}function refreshEmps(roleId,selectEmps){ajax.AjaxPost({sessionId:sessionId,roleId:roleId},"userManager/empManager/getEmpByRoleId.do").then(function(result){$scope.emps=result.data,$scope.emps=regroupEmps($scope.emps,selectEmps)})}function regroupEmps(arr1,arr2){var newArr=angular.copy(arr1);if(arr1.length!==0||arr2.length!==0)for(var i=0;i<arr1.length;i++)for(var j=0;j<arr2.length;j++)if(arr1[i].empId===arr2[j].empId){var index=inArray(newArr,arr1[i]);index!==-1&&newArr.splice(index,1)}return newArr}function inArray(arr,item){for(var i=0;i<arr.length;i++)if(arr[i].empId===item.empId)return i;return-1}var sessionId=cookie.getCookie("CRMSESSIONID");$scope.roles=[],$scope.roleModel={},ajax.AjaxPost({sessionId:sessionId},"usermanager/rolemanager/getRoleCombo.do").then(function(result){$scope.roles=result.data,$scope.roleModel.roleId=$scope.roles[0].value,$scope.watchRoleId=$scope.roleModel.roleId}),$scope.$watch("watchRoleId",function(roleId){roleId&&getEmpByRoleId(roleId)}),$scope.changeRoleId=function(roleId){getEmpByRoleId(roleId)},$scope.selected=[],$scope.checkAll=!1,$scope.checked=!1,$scope.selectAllEmp=function(checkAll,emps){if(checkAll===!0){$scope.checked=!0,$scope.selected=[];for(var i=0;i<emps.length;i++)$scope.selected.push(emps[i])}else $scope.checked=!1,$scope.selected=[]};var updateSelected=function(action,emp){action=="add"&&$scope.selected.indexOf(emp)===-1&&$scope.selected.push(emp);if(action=="remove"&&$scope.selected.indexOf(emp)!==-1){var idx=$scope.selected.indexOf(emp);$scope.selected.splice(idx,1)}$scope.selected.length==0&&($scope.checkAll=!1)};$scope.updateSelection=function($event,emp){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,emp)},$scope.isEmpSelected=function(emp){return $scope.selected.indexOf(emp)>=0},$scope.sureRecipient=function(){$uibModalInstance.close($scope.selected),$scope.selected=[]},$scope.cancelRecipient=function(){$uibModalInstance.dismiss("cancel")}}])});