define(["macarons","echart","css!myindex_css","jquery"],function(macarons,echart){function setEchars(param){jquery1.AjaxPost(param.data,param.url).then(function(result){setInit(result)})}function setInit(result){myChart4=echart.init(document.getElementById("main4"),"macarons");var option={title:{text:"储值"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{show:!0,x:"1100",feature:{saveAsImage:{show:!0}}},calculable:!0,legend:{data:["储值笔数","储值金额"]},xAxis:[{type:"category",data:result.data.showDate,splitLine:{show:!1}}],yAxis:[{type:"value",name:"单位:元",axisLabel:{formatter:"{value}"}},{type:"value",axisLabel:{formatter:"{value}"}}],series:[{name:"储值笔数",type:"bar",smooth:!0,barWidth:40,data:result.data.saveMoneyCount},{name:"储值金额",type:"line",yAxisIndex:1,smooth:!0,data:result.data.saveMoneySum}]};myChart4.setOption(option)}function setEcharArrays(param){jquery1.AjaxPost(param.data,param.url).then(function(result){set_echars1(result,"main1",[result.memberConsumeReportDay.data.showDate,result.memberConsumeReportDay.data.memberMoney,result.turnoverReportDay.data.turnoverMoney]);var arrays=new Array;for(var i=0;i<result.memberConsumeReportDay.data.memberConsumeCount.length;i++)parseInt(result.turnoverReportDay.data.turnoverCount[i])==0?arrays[i]=0:(arrays[i]=parseInt(result.memberConsumeReportDay.data.memberConsumeCount[i])*100/parseInt(result.turnoverReportDay.data.turnoverCount[i]),arrays[i]=arrays[i].toFixed(2));set_echars2(result,"main2",[result.memberConsumeReportDay.data.showDate,result.memberConsumeReportDay.data.memberConsumeCount,result.turnoverReportDay.data.turnoverCount,arrays]),set_echars3(result,"main3",[result.turnoverReportDay.data.showDate,result.memberConsumeReportDay.data.memberAvg,result.turnoverReportDay.data.turnoverAvg]),window.onresize=function(){myChart1.resize(),myChart2.resize(),myChart3.resize(),myChart4.resize()}})}function setEcharArraysMonth(param){jquery1.AjaxPost(param.data,param.url).then(function(result){set_echars1(result,"main1",[result.memberConsumeReportMonth.data.showDate,result.memberConsumeReportMonth.data.memberMoney,result.turnoverReportMonth.data.turnoverMoney]);var arrays=new Array;for(var i=0;i<result.memberConsumeReportMonth.data.memberConsumeCount.length;i++)parseInt(result.turnoverReportMonth.data.turnoverCount[i])==0?arrays[i]=0:(arrays[i]=parseInt(result.memberConsumeReportMonth.data.memberConsumeCount[i])*100/parseInt(result.turnoverReportMonth.data.turnoverCount[i]),arrays[i]=arrays[i].toFixed(2));set_echars2(result,"main2",[result.memberConsumeReportMonth.data.showDate,result.memberConsumeReportMonth.data.memberConsumeCount,result.turnoverReportMonth.data.turnoverCount,arrays]),set_echars3(result,"main3",[result.turnoverReportMonth.data.showDate,result.memberConsumeReportMonth.data.memberAvg,result.turnoverReportMonth.data.turnoverAvg]),window.onresize=function(){myChart1.resize(),myChart2.resize(),myChart3.resize(),myChart4.resize()}})}function set_echars2(data,name,value){myChart2=echart.init(document.getElementById(name),"macarons");var option={title:{text:"消费笔数"},tooltip:{trigger:"axis"},toolbox:{show:!0,x:"1100",feature:{saveAsImage:{show:!0}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},calculable:!0,legend:{data:["会员笔数","总笔数","刷卡会员占比"]},xAxis:[{type:"category",data:value[0]},{type:"category",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},splitArea:{show:!1},splitLine:{show:!1},data:value[0]}],yAxis:[{type:"value",name:"单位:笔",splitLine:{show:!0,lineStyle:{color:["#ddd"],width:1,type:"solid"}}},{type:"value",splitLine:{show:!1},axisLabel:{formatter:"{value}%"}}],series:[{name:"会员笔数",type:"bar",itemStyle:{normal:{label:{show:!0,formatter:function(p){return p.value>0?p.value:""}}}},xAxisIndex:0,barWidth:20,data:value[1]},{name:"总笔数",type:"bar",itemStyle:{normal:{label:{show:!0,formatter:function(p){return p.value>0?p.value:""}},color:"rgba(218, 208, 238,.7)"}},xAxisIndex:1,barWidth:40,data:value[2]},{name:"刷卡会员占比",type:"line",yAxisIndex:1,smooth:!0,data:value[3]}]};myChart2.setOption(option)}function set_echars1(data,name,value){myChart1=echart.init(document.getElementById(name),"macarons");var option={title:{text:"营业额"},tooltip:{trigger:"axis"},toolbox:{show:!0,x:"1100",feature:{saveAsImage:{show:!0}}},legend:{data:["会员账单","营业额"]},calculable:!0,grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:value[0],boundaryGap:!1,splitLine:{show:!1}}],yAxis:[{type:"value",name:"单位:元",splitLine:{show:!0,lineStyle:{width:1,type:"solid"}}}],series:[{name:"会员账单",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:value[1]},{name:"营业额",type:"line",smooth:!0,areaStyle:{normal:{opacity:.3}},data:value[2]}]};myChart1.setOption(option)}function set_echars3(data,name,value){myChart3=echart.init(document.getElementById(name),"macarons");var option={title:{text:"客单价"},tooltip:{trigger:"axis"},toolbox:{show:!0,x:"1100",feature:{saveAsImage:{show:!0}}},legend:{data:["会员客单价","客单价"]},xAxis:{type:"category",boundaryGap:!1,data:value[0],splitLine:{show:!1}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},yAxis:[{type:"value",name:"单位:元",splitLine:{show:!0,lineStyle:{width:1,type:"solid"}}}],series:[{name:"会员客单价",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:value[1]},{smooth:!0,name:"客单价",type:"line",data:value[2],areaStyle:{normal:{opacity:.3}}}]};myChart3.setOption(option)}echart.registerTheme("macarons",macarons);var jquery1,myChart2,myChart1,myChart3,ngAMD=require("ngAMD");return ngAMD.controller("inCtrl",["$scope","$rootScope","ajaxService",function($scope,$rootScope,ajaxService){jquery1=ajaxService;var sessionId=$rootScope.sessionId;ajaxService.AjaxPost({sessionId:sessionId},"reportcenter/index/load.do").then(function(result){$scope.list=result.data}),$scope.beginDate,$scope.endDate,$scope.dates=[{name:"近7天",statu:!0,title:1,date:7,format:"MM/dd",toDay:!1,type:"DAY",count:7},{name:"近15天",statu:!1,title:2,date:15,format:"MM/dd",toDay:!1,type:"DAY",count:15},{name:"近30天",statu:!1,title:3,date:30,format:"MM/dd",toDay:!1,type:"DAY",count:30},{name:"近12个月",statu:!1,title:4,date:11,format:"yyyy/MM",toDay:!0,type:"MONTH",count:11}],$scope.setDateColor=function(date,title){$scope.dates.forEach(function(date){date.statu=!1}),date.statu=!0,$scope.clickDate(date)},$scope.chartParam={data:{reportName:"memberSaveMonryReportDay",sessionId:sessionId,date:7,dateExecute:!0,format:"MM/dd",toDay:!1,type:"DAY",size:-1,count:7,label:"showDate",field:["showDate","saveMoneySum","saveMoneyCount"]},url:"reportcenter/index/list.do"},$scope.chartArrParam={data:{sessionId:sessionId,mainReportArray:[{reportName:"memberConsumeReportDay",sessionId:sessionId,date:7,dateExecute:!0,format:"MM/dd",toDay:!1,type:"DAY",size:-1,count:7,label:"showDate",field:["showDate","memberMoney","memberConsumeCount","memberAvg"]},{reportName:"turnoverReportDay",sessionId:sessionId,date:7,dateExecute:!0,format:"MM/dd",toDay:!1,type:"DAY",size:-1,count:7,label:"showDate",field:["showDate","turnoverMoney","turnoverCount","turnoverAvg"]}]},url:"reportcenter/index/arraylist.do"},setEchars($scope.chartParam),setEcharArrays($scope.chartArrParam),$scope.clickDate=function(date){$scope.chartParam.data.date=date.date,$scope.chartParam.data.format=date.format,$scope.chartParam.data.toDay=date.toDay,$scope.chartParam.data.type=date.type,$scope.chartParam.data.count=date.count,date.title===4?$scope.chartParam.data.reportName="memberSaveMonryReportMonth":$scope.chartParam.data.reportName="memberSaveMonryReportDay",setEchars($scope.chartParam),angular.forEach($scope.chartArrParam.data.mainReportArray,function(mainReport){mainReport.date=date.date,mainReport.format=date.format,mainReport.toDay=date.toDay,mainReport.type=date.type,mainReport.count=date.count}),date.title===4?($scope.chartArrParam.data.mainReportArray[0].reportName="memberConsumeReportMonth",$scope.chartArrParam.data.mainReportArray[1].reportName="turnoverReportMonth",setEcharArraysMonth($scope.chartArrParam)):($scope.chartArrParam.data.mainReportArray[0].reportName="memberConsumeReportDay",$scope.chartArrParam.data.mainReportArray[1].reportName="turnoverReportDay",setEcharArrays($scope.chartArrParam))}}]),"inCtrl"});