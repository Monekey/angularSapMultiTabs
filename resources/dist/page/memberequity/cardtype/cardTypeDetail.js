define(["require","ngAMD","angular"],function(require){var ngAMD=require("ngAMD"),angular=require("angular");ngAMD.controller("cardTypeDetail",["$scope","$rootScope","ajaxService","register",function($scope,$rootScope,ajaxService,register){function getMonth(date){return date.substring(0,date.indexOf("-"))}function getDay(date){return date.substring(date.indexOf("-")+1,date.length)}var sessionId=$rootScope.sessionId;$scope.scoreWay={0:"按金额",1:"按操作"},$scope.exchangeWay={0:"电子券",1:"实物"},$scope.savingWay={0:"线上储值",1:"线下储值"},$scope.edit=register.getRoot("修改"),$scope.cardTypeDetail={baseInfo:{},scoreSet:{},limitSet:{},relSavingRules:[],relExchangeRules:[]};var data=angular.copy($rootScope.TabsData);console.log(data);var cardTypeId=data.id;$scope.from=data.from;var testParam={sessionId:sessionId,id:cardTypeId,isEdit:0};ajaxService.AjaxPost(testParam,"memberequity/cardtype/baseInfo.do").then(function(result){$scope.cardTypeDetail.baseInfo=result.baseInfo,$scope.cardTypeDetail.baseInfo.isScore&&$scope.cardTypeDetail.baseInfo.isScore===1&&ajaxService.AjaxPost(testParam,"memberequity/cardtype/scoreSet.do").then(function(result){$scope.cardTypeDetail.scoreSet=result.scoreSet;if(result.scoreSet.clearDate&&result.scoreSet.clearDate.length>0){var month=getMonth(result.scoreSet.clearDate),day=getDay(result.scoreSet.clearDate);$scope.cardTypeDetail.scoreSet.clearMonth=month,$scope.cardTypeDetail.scoreSet.clearDay=day}else $scope.cardTypeDetail.scoreSet.clearMonth="",$scope.cardTypeDetail.scoreSet.clearDay=""}),$scope.cardTypeDetail.baseInfo.isExchange&&$scope.cardTypeDetail.baseInfo.isExchange===1&&ajaxService.AjaxPost(testParam,"memberequity/cardtype/relExchangeRules.do").then(function(result){$scope.cardTypeDetail.relExchangeRules=result.relExchangeRules}),$scope.cardTypeDetail.baseInfo.isSaving&&$scope.cardTypeDetail.baseInfo.isSaving===1&&ajaxService.AjaxPost(testParam,"memberequity/cardtype/relSavingRules.do").then(function(result){$scope.cardTypeDetail.relSavingRules=result.relSavingRules}),$scope.cardTypeDetail.baseInfo.isUseLimit&&$scope.cardTypeDetail.baseInfo.isUseLimit===1&&ajaxService.AjaxPost(testParam,"memberequity/cardtype/limitSet.do").then(function(result){$scope.cardTypeDetail.limitSet=result.limitSet})}),$scope.cancelIn=function(){register.switchTab({id:$scope.from})},$scope.gotoEdit=function(cardTypeDetail){console.log(cardTypeDetail);var cardType={id:cardTypeDetail.baseInfo.id,callback:$rootScope.TabsData.callback},editTab={title:"修改卡型规则",id:"cardTypeEdit"+cardType.id,from:$scope.from,ctrlName:"cardTypeEdit",ctrl:"memberequity/cardtype/cardTypeEdit",template:"memberequity/cardtype/cardTypeEdit.html",type:"single",ng_show:!1};register.addToTabs(editTab,cardType)}}])});