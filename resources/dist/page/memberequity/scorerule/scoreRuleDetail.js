define(["require","ngAMD"],function(require){var ngAMD=require("ngAMD");ngAMD.controller("scoreRuleDetail",["$scope","$rootScope","ajaxService","register",function($scope,$rootScope,ajaxService,register){function FormatDate(strTime){var date=new Date(strTime),year=date.getFullYear(),month=date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1,day=date.getDate()<10?"0"+date.getDate():date.getDate();return year+"-"+month+"-"+day}var sessionId=$rootScope.sessionId;$scope.edit=register.getRoot("修改"),$scope.typeShow=!0,$scope.multipleShow=!1,$scope.operationlist=[{name:"消费",operationId:1,type:0,scoreRuleId:1}],$scope.initWeeks=[{date:"星期一",state:!1,value:1},{date:"星期二",state:!1,value:2},{date:"星期三",state:!1,value:3},{date:"星期四",state:!1,value:4},{date:"星期五",state:!1,value:5},{date:"星期六",state:!1,value:6},{date:"星期日",state:!1,value:7}],$scope.weekDate=[],$scope.rule_data={type:0,terminal:[],operation:[],week:[],scoreRule:{name:"",howMoney:1,howScore:1,multiple:1,handling:1,isTerminal:0,isTime:0,isBirthday:0,isWeek:0,startTime:null,endTime:null,note:"",isAble:0}},$scope.handling=function(i){if(i==1)return"不积分";if(i==2)return"四舍五入";if(i==3)return"去尾法"};var data=$rootScope.TabsData;$scope.rule_data.scoreRule=data,$scope.from=data.from,$scope.date_start=FormatDate(new Date(data.startTime)),$scope.date_end=FormatDate(new Date(data.endTime)),data.type==1&&($scope.typeShow=!1),data.isBirthday==1&&($scope.multipleShow=!0);var searchkey={sessionId:sessionId,id:data.id,type:data.type};ajaxService.AjaxPost(searchkey,"memberEquity/scoreRule/operationlist.do").then(function(result){$scope.operationlist=result.operations,ajaxService.AjaxPost({sessionId:$rootScope.sessionId,id:data.id},"memberEquity/scoreRule/weeklist.do").then(function(result){for(var i in $scope.initWeeks){var x={};x.date=$scope.initWeeks[i].date,x.value=$scope.initWeeks[i].value,x.state=!1;for(var j=0;j<result.data.length;j++)if(result.data[j]==$scope.initWeeks[i].value){x.state=!0;break}$scope.weekDate.push(x)}})}),ajaxService.AjaxPost(searchkey,"memberEquity/scoreRule/relTerminals.do").then(function(result){$scope.relTerminals=result.relTerminals}),$scope.cancel=function(){register.switchTab({id:$scope.from})},$scope.gotoEdit=function(ruledata){var editTab={title:"修改积分规则",ctrlName:"scoreRuleEdit",ctrl:"memberequity/scorerule/scoreRuleEdit",template:"memberequity/scorerule/scoreRuleEdit.html",id:"scoreEdit"+ruledata.scoreRule.id,from:$scope.from,type:"single",ng_show:!1};register.addToTabs(editTab,ruledata.scoreRule)}}])});