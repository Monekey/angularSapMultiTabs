define(["require","ngAMD","angular"],function(require){var ngAMD=require("ngAMD"),angular=require("angular");ngAMD.controller("cardUpgradeRuleCreateCtrl",["$scope","$rootScope","ajaxService","getCookieService","register","modalService",function($scope,$rootScope,ajaxService,getCookieService,register,modalService){var tabData=$rootScope.TabsData,data=angular.copy(tabData);$scope.from=data.from,$scope.card_upgrade_data={sessionId:$rootScope.sessionId,upgradeType:1,upgradeStatus:1,name:"",initList:[{value:"",upCardTypeId:""}]},$scope.card_upgrade_data.sessionId=$rootScope.sessionId,$scope.confirmIn=function(){$scope.disabledBtn=!0,ajaxService.AjaxPost($scope.card_upgrade_data,"memberequity/cardupgrade/create.do").then(function(result){result.status==1&&modalService.info({content:"新建成功!",type:"ok"}).then(function(obj){obj.status=="ok"&&($rootScope.TabsData.callback(),register.switchTab({id:$scope.from}))},function(obj){$rootScope.TabsData.callback(),register.switchTab({id:$scope.from})})}),$scope.disabledBtn=!1},ajaxService.AjaxPost({sessionId:$rootScope.sessionId,pageCount:1e3},"memberequity/cardupgrade/cardTypeCombo.do").then(function(result){$scope.comboList=result.pageInfo.list}),$scope.checkTag=!1,$scope.checkThisValue=function(index,value){$scope.checkTag=!1;if($scope.card_upgrade_data.initList[index-1])var min=parseFloat($scope.card_upgrade_data.initList[index-1].value)+1;if($scope.card_upgrade_data.initList[index+1])var max=parseFloat($scope.card_upgrade_data.initList[index+1].value)-1;min&&!max&&value<min&&($scope.checkTag=!0),min&&max&&(value<min||value>max)&&($scope.checkTag=!0),!min&&max&&value>max&&($scope.checkTag=!0)},$scope.checkSelect=!1,$scope.checkIsSelected=function(index,one){$scope.checkSelect=!1;var rule=angular.copy($scope.card_upgrade_data.initList);rule.splice(index,1);for(var i=0;i<rule.length;i++)one.upCardTypeId===rule[i].upCardTypeId&&($scope.checkSelect=!0)},$scope.Count=1,$scope.add=function(type){type==0&&$scope.Count++;var addObj={value:"",upCardTypeId:""};$scope.card_upgrade_data.initList.push(addObj)},$scope.reduce=function(index,type){type==0&&$scope.Count--,$scope.card_upgrade_data.initList.splice(index,1)},$scope.cancelIn=function(){register.switchTab({id:$scope.from})}}])});