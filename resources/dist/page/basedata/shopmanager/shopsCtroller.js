define(["require","css!score_rule_css","css!../../../assets/css/company","ngAMD"],function(require){var app=require("css!score_rule_css"),shopCss=require("css!../../../assets/css/company"),ngAMD=require("ngAMD");return ngAMD.controller("shopsCtrl",["$scope","appConstant","register","$rootScope","ajaxService",function($scope,appConstant,register,$rootScope,ajaxService){var sessionId=$rootScope.sessionId;$scope.conditions={ajaxUrl:"baseData/shopManager/list.do",request:{sessionId:sessionId,pageNo:"1",pageCount:appConstant.pageSet.numPerPage},filter:[{type:"normal",field:"省市：",requestFiled:"cityId",value:[],ajaxUrl:"baseData/shopManager/cityCount.do",request:{sessionId:sessionId,pageNo:1,pageCount:20}}]},$scope.edit=register.getRoot("修改"),$scope.pageSet={title:"门店列表",currentPage:appConstant.pageSet.currentPage,maxSize:appConstant.pageSet.maxSize,numPerPage:appConstant.pageSet.numPerPage},$scope.division=appConstant.division,$scope.getArea=function(cityId){var provinceId=(cityId+"").substr(0,2),areas;return $scope.division.forEach(function(province){if(province.id==provinceId){areas=province.areas;return}}),areas},$scope.openNew=function(shop){shop.callback=function a(callback){console.log($scope),ajaxService.AjaxPost({sessionId:sessionId,pageNo:1,pageCount:20},"baseData/shopManager/cityCount.do").then(function(result){var total=0,data=result.pageInfo.list,params=[],param={name:"全部",state:!0,value:null,count:"0"};params.push(param);for(var i=0;i<data.length;i++){var param={};param.name=data[i].cityName,param.state=!1,param.value=data[i].id,param.count=data[i].count,total+=Number(data[i].count),params.push(param)}params[0].count=total,$scope.conditions.filter[0].value=params}),$scope.pageChanged()},register.addToTabs({title:"修改门店信息",id:"shop"+shop.id,template:"basedata/shopmanager/shopEdit.html",ctrl:"basedata/shopmanager/shopEdit",ctrlName:"shopUpdateCtrl",ng_show:!1,type:"single",from:10010},shop)},$scope.doTeminal=function(shop){register.openTabWithRequest({id:10012},{searchType:1,searchTypeValue:shop.name})},$scope.pageChanged=function(){var postObj=$scope.requestObj.request;postObj.pageNo=$scope.pageSet.currentPage,postObj.pageCount=$scope.pageSet.numPerPage,ajaxService.AjaxPost(postObj,$scope.conditions.ajaxUrl).then(function(result){$scope.resultList=result})}}]),"shopsCtrl"});