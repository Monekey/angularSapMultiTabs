define(["require","ngAMD","css!myindex_css","echart","macarons","jquery"],function(require){function tab(){$_true(this).addClass("blue").siblings().removeClass("blue");var tab=$_true(this).attr("title");$_true("#"+tab).show().siblings().hide()}function init_setEchars(param){param.data.companyId=companyId,jquery1.AjaxPost(param.data,param.url).then(function(result){var chart=echart.init(document.getElementById(param.id),"macarons");chart.clear(),chart.setOption({tooltip:{trigger:"axis",formatter:"{a} {b} {c}"+param.label},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{show:!0,x:"1200",y:"5",feature:{saveAsImage:{show:!0}}},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:result.name,splitLine:{show:!1}}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{color:["#ddd"],width:1,type:"solid"}}}],series:[{type:"line",stack:"总量",name:titleName,data:result.value,smooth:!0,itemStyle:{normal:{label:{show:!0,formatter:function(p){return p.value>0?p.value:""}},areaStyle:{type:"default"}}}}]}),window.onresize=chart.resize})}var ngAMD=require("ngAMD"),app=require("css!myindex_css"),echart=require("echart"),macarons=require("macarons");echart.registerTheme("macarons",macarons);var $_true=require("jquery");$_true(".tab li").click(function(){$_true(this).addClass("blue").siblings().removeClass("blue");var tab=$_true(this).attr("title");$_true("#"+tab).show().siblings().hide()});var jquery1,companyId,titleName="会员数";return ngAMD.controller("indexCtrl",["$scope","ajaxService","$rootScope","register",function($scope,ajaxService,$rootScope,register){var sessionId=$rootScope.sessionId;jquery1=ajaxService,ajaxService.AjaxPost({sessionId:sessionId,data:1},"index/busiSMS/load.do").then(function(result){$scope.surplusCount=result.showCount,$scope.showName=result.showName,$scope.showURL=result.showLogo}),ajaxService.AjaxPost({showCount:5,sessionId:sessionId},"index/sysMsg/load.do").then(function(result){$scope.list=result.pageInfo.list}),$scope.isShow=function(hot){return hot==1?"block":"none"},ajaxService.AjaxPost({sessionId:sessionId},"index/memberReport/load.do").then(function(result){$scope.memberCount=result.data.memberCount,$scope.toDayMemberCount=result.data.toDayMemberCount,$scope.toDayConsume=result.data.toDayConsume,result.data.addMemberCount=="-"?($scope.addMemberCount=result.data.addMemberCount,$_true("#addMemberCount").remove()):result.data.addMemberCount>=0?($scope.addMemberCount=result.data.addMemberCount+"%",$scope.addMemberCountImg="&#xe62e;",$scope.addMemberCountChose="1"):($scope.addMemberCount=-result.data.addMemberCount+"%",$scope.addMemberCountImg="&#xe62d",$scope.addMemberCountChose="2"),result.data.addDayConsume=="-"?($scope.addDayConsume=result.data.addDayConsume,$_true("#addDayConsume").remove()):result.data.addDayConsume>=0?($scope.addDayConsume=result.data.addDayConsume+"%",$scope.addDayConsumeImg="&#xe62e;",$scope.addDayConsumeChose="1"):($scope.addDayConsume=-result.data.addDayConsume+"%",$scope.addDayConsumeImg="&#xe62d;",$scope.addDayConsumeChose="2"),companyId=result.companyId,init_setEchars($scope.chartParam)}),$scope.chartParam={id:"main",data:{reportName:"memberCountReportDay",sessionId:sessionId,date:7,dateExecute:!0,format:"MM月dd日",toDay:!1,type:"DAY",size:-1,count:7},url:"index/memberReport/list.do",label:"个"},$scope.clickDate=function(date){$scope.chartParam.data.date=date.date,$scope.chartParam.data.format=date.format,$scope.chartParam.data.type=date.type,$scope.chartParam.data.count=date.count,$scope.chartParam.data.reportName=date.reportName,$scope.chartParam.data.toDay=date.toDay,init_setEchars($scope.chartParam)},$scope.addTab1=function(){register.addToTabs({title:"系统消息",id:"add2ctrl",template:"myindex/sysmsg/sysmsg.html",ctrl:"myindex/sysmsg/sysmsg",ctrlName:"add2ctrl",ng_show:!1,type:"single",from:10001},{a:1})},$scope.addWarning=function(){$scope.conditions={},register.openTabWithRequest({id:10043},{})},$scope.allMember=function(){register.openTabWithRequest({id:10013},{select:"all"})},$scope.todayMember=function(){register.openTabWithRequest({id:10013},{select:"toDay"})},$scope.todayTrans=function(){register.openTabWithRequest({id:10015},{select:"toDay"})},$scope.dates=[{name:"近7天",statu:!0,title:1,date:7,format:"MM月dd日",type:"DAY",count:7,reportName:"memberCountReportDay",toDay:!1},{name:"近15天",statu:!1,title:2,date:15,format:"MM月dd日",type:"DAY",count:15,reportName:"memberCountReportDay",toDay:!1},{name:"近30天",statu:!1,title:3,date:30,format:"MM月dd日",type:"DAY",count:30,reportName:"memberCountReportDay",toDay:!1},{name:"近12个月",statu:!1,title:4,date:11,format:"yyyy年MM月",type:"MONTH",count:11,reportName:"memberCountReportMonth",toDay:!0}],$scope.setDateColor=function(date,title){$scope.dates.forEach(function(date){date.statu=!1}),date.statu=!0,$scope.clickDate(date)},$scope.typers=[{name:"会员数",statu:!0,title:"d1",chartId:"main",reportDayName:"memberCountReportDay",reportMonthName:"memberCountReportMonth",label:"个"},{name:"会员消费",statu:!1,title:"d2",chartId:"maina",reportDayName:"memberConsumeReportDay",reportMonthName:"memberConsumeReportMonth",label:"元"},{name:"会员积分",statu:!1,title:"d3",chartId:"mainb",reportDayName:"memberScoreReportDay",reportMonthName:"memberScoreReportMonth",label:"分"},{name:"会员储值",statu:!1,title:"d4",chartId:"maind",reportDayName:"memberSaveMonryReportDay",reportMonthName:"memberSaveMonryReportMonth",label:"元"}],$scope.setColor=function(typer){$scope.typers.forEach(function(typer){typer.statu=!1;var tab=typer.title;$_true("#"+tab).hide()}),typer.statu=!0,titleName=typer.name,$scope.dates.forEach(function(date){date.title===4?date.reportName=typer.reportMonthName:date.reportName=typer.reportDayName,date.statu=!1}),$scope.dates[0].statu=!0,$scope.chartParam.id=typer.chartId,$scope.chartParam.label=typer.label;var tab=typer.title;$_true("#"+tab).show(),$scope.clickDate($scope.dates[0]),$_true("#"+typer.chartId).show()}}]),"indexCtrl"});